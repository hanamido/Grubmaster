<!-- reviews.hbs -->
<!--  Written baesd on the github guide for the course -->

[ <a href="/">Home</a> | <a href="/restaurants">Restaurants</a> | <a href="/users">Users</a> | <a href="/cities">Cities</a> | <a href="/reviews">Reviews</a> | <a href="/restaurant_has_cuisines">Restaurants' Cuisines</a>]

<head>
    <meta charset="utf-8">
    <title>Reviews</title>
    <meta name="viewport" content="initial-scale=1, shrink-to-fit=yes">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous"/>
    {{!-- <link rel="stylesheet" type="text/css" href="extensions/filter-control/bootstrap-table-filter-control.css"/> --}}
    <link rel="stylesheet" href="/css/style.css" type="text/css"/>
</head>

<h2>Search Reviews</h2>
<form id="search-review-html" method='GET' action='/reviews'>
    <label for="input-lname">Search by Restaurant Name: </label>
    <input type="text" name="review_restaurant_name" id="input-restaurant-name-html-search">
    <input type="submit">
    <a href='/reviews'><button>Reset</button></a>
</form>
<p>&nbsp;</p>

{{!-- Create a table --}}
<table id="reviews-table">
    {{!-- Header section --}}
    <thead>
        {{!-- For just the first row, we print each key of the row object as a header cell so we
        know what each column means when the page renders --}}
        <tr id="headers">
            <th class="header" scope="col">ID</th>
            <th class="header" scope="col">Rating</th>
            <th class="header" scope="col">Date</th>
            <th class="header" scope="col">Restaurant</th>
            <th class="header" scope="col">User</th>
            <th class="header" scope="col" colspan="2">Actions</th>
        </tr>
    </thead>

    {{!-- Body section --}}
    <tbody>
        {{!-- For each row, print the id, name, website, email and city --}}
        {{#each data}}
        <tr>
            <td>{{this.review_id}}</td>
            <td>{{this.review_rating}}</td>
            <td>{{this.review_date}}</td>
            <td>{{this.review_restaurant_id}}</td>
            {{#if this.review_user_id}}
                <td>{{this.review_user_id}}</td>
                    {{else}}
                <td>NULL</td>
            {{/if}}
            <td><button onclick="deleteReview({{this.review_id}})">Delete</button></td>
        </tr>
        {{/each}}
    </tbody>
</table>

<p>&nbsp;</p>
<h2>Add a Review</h2>
<p>Add a new review to the database.</p>
<div id="insert" style="display: block">
  <form method="POST" id="add-review-form-ajax">
        <fieldset class="fields">
          <form class="p-1 mb-1 bg-light border-bottom">
            <label>Restaurant</label> 
                <select name="restaurant" id="restaurant">
                    <option value="">Select a Restaurant</option>
                    {{#each restaurants}}
                    <option value="{{this.restaurant_id}}">{{this.restaurant_name}}</option>
                    {{/each}}
                </select>
            <input type="hidden" name="restaurantRating" id="addRestaurantRating" value="1">
            <label> Rating: </label>
              <select>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
              </select>
            <label>First Name*</label> <input type="text" name="first_name" id="first_name">
            <label>Last Name*</label> <input type="text" name="last_name" id="first_name">

    </fieldset>
        <input class="btn" type="submit" id="add-review-form-ajax" value="Add Review">
        <input class="btn" type="button" value="Cancel" onClick="browseReviews()">
</form> 
</div><!-- Add New Review -->

<p>&nbsp;</p>
<h2>Update A Review's Information</h2>
<p>Use the search function to locate the correct Review ID, then update its rating information using this form.</p>
<form id="update-review-form-ajax">
    <fieldset class="fields">
        <form class="p-1 mb-1 bg-light border-bottom">
        <label>Review ID*</label> 
            <select name="review_id" id="selected_review_id">
                <option value="">Select a Review ID</option>
                {{#each data}}
                <option value="{{this.review_id}}">{{this.review_id}}</option>
                {{/each}}
            </select>  
        <input type="hidden" name="restaurantRating" id="updateRestaurantRating" value="1">
            <label> Rating: </label>
              <select>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
              </select>             
    </fieldset>
    <input class="btn" type="submit" id="add-user-form-ajax" value="Update User">
</form><!-- Update User -->

<script>

// Creates a single row from an Object representing a single record from 
// Reviews
addRowToTable = (data) => {

    // Get a reference to the current table on the page and clear it out.
    let currentTable = document.getElementById("Reviews-table");

    // Get the location where we should insert the new row (end of table)
    let newRowIndex = currentTable.rows.length;

    // Get a reference to the new row from the database query (last object)
    let parsedData = JSON.parse(data);
    let newRow = parsedData[parsedData.length - 1]

    // Create a row
    let row = document.createElement("TR");
    let idCell = document.createElement("TD");
    let firstNameCell = document.createElement("TD");
    let lastNameCell = document.createElement("TD");
    let emailAddressCell = document.createElement("TD");
    let cityCell = document.createElement("TD");

    // Fill the cells with correct data
    idCell.innerText = newRow.review_id;
    firstNameCell.innerText = newRow.review_first_name;
    lastNameCell.innerText = newRow.review_last_name;
    emailAddressCell.innerText = newRow.review_email;
    cityCell.innerText = newRow.address_city;

    // Add the cells to the row 
    row.appendChild(idCell);
    row.appendChild(firstNameCell);
    row.appendChild(lastNameCell);
    row.appendChild(emailAddressCell);
    row.appendChild(cityCell);
    
    // Add the row to the table
    currentTable.appendChild(row);
}

</script>


